<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta http-equiv="Access-Control-Allow-Origin" content="*">
<title isback="1" btn="0" navbar="0" id="titleText">动感单车</title>
<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
<script type="text/javascript" src="js/jquery.min.js"></script><!--gcourseid=GC000042&memid=M000458-->
    <script>
        $(document).bind('mobileinit', function () {
            $.mobile.pushStateEnabled = false;
        });
    </script>
<script type="text/javascript" src="js/jquery.mobile-1.4.5.min.js"></script>
<script type="application/javascript" src="js/iscroll.js"></script>
<script type="text/javascript" src="js/touchslider.js"></script>
<script src="js/mframe.js"></script>
</head>
<body>
<div class="person_index"> </div>

<div data-role="content" class="p_content">

  <div id="slider" class="swipe cou_sw" <!--style="display: none;"-->>
    <ul class="box01_list">
      <li class="li_list">
        <div class="video"> <a rel="external" data-role="none"><img src="images/page/zhanwei.png" onerror="nofind();" id="imgpfile"/></a> </div>
        <div class="corder">
          <p class="corder_title" id="gcoursename">动感单车</p>
          <span class="price" style="padding-right: 11px;"><i id="gcourseprice" name="gcourseprice" style="color: #969696;font-weight: normal;font-size: 16px;padding-top: 7px;"></i></span></div>
        <div class="corder_name"><!--<i id="coachname">张宇星</i> | --><i id="clubname"> 沈阳羿健康健身俱乐部</i></div>
        <!--<div class="corder_star">
			<div class="star_kong">
				<img src="images/icon_xingxing_kongxin.png" />
				<img src="images/icon_xingxing_kongxin.png" />
				<img src="images/icon_xingxing_kongxin.png" />
				<img src="images/icon_xingxing_kongxin.png" />
				<img src="images/icon_xingxing_kongxin.png" />
			</div>
			<div class="star_shi">
				<div style="width: 100px;">
					<img src="images/icon_xingxing.png" />
					<img src="images/icon_xingxing.png" />
					<img src="images/icon_xingxing.png" />
					<img src="images/icon_xingxing.png" />
					<img src="images/icon_xingxing.png" />
				</div>
				
			</div>
			
		</div>-->
        <div class="hr1" style="margin-top: 24px;"></div>
        <div id="datum-arr" class="mess-list">
		
          <!--<a id="tog"  rel="external" data-role="none">-->
      	<a href="" class="click_club" rel="external" data-role="none" style="display:block;">
			<p id="address">沈阳市和平区市府大路北<span id="club_title" style="color:#D6D6D6 ;float: right;"></span></p>
			<!--<img id="arrou" class="arrou" src="images/jiantou_botton_default.png" style="width: 18px;height: 18px;"/>--> </a>
		<a id="tog" href="javascript:void(0);" rel="external" data-role="none" class="click_times"> <p><span class="tenper"><!--<em id="pcoursetimes">10次</em>/<em id="pcoursedays">2月</em>--><em id="begintime">10月29日</em></span><span id="coursetitle" style="float: right;color: #d6d6d6;"></span></p><img class="arrou" id="arrou" src="images/jiantou_botton_down.png" style="width: 18px;height: 18px.;"> </a>
		<div id="togg">
			<ul>
				
			</ul>
		</div>
		<a rel="external" data-role="none" class="click_tel">
			<p id="conphone" href="tel:130111">13011111111</p>
			<img class="arrou" src="images/jiantou_botton_default.png" style="width: 18px;height: 18px;">
			<div class="hr1-cxl" style="border: 0 none;"></div>
		</a>
          <!--<p id="address"></p>-->
         
          <!--根据业务需要不要-->
         <!-- <a  rel="external" data-role="none"> <span class="tenper"><i>10次</i id="gcoursetimes">/<i id="gcoursedays">2月</i></span> <img id="arrou" class="arrou"  src="images/arrow2.png"/></a>-->
          
          <!--<a style="display: none;"  id="detailsurl" rel="external" data-role="none">
            <p>点击查看图文介绍</p><img class="arrou" src="images/arrow2.png">
          </a> -->
        </div>
        <!--<div class="introduce">
          <div class="title-cxl">详细介绍</div>
          <div class="content" >
            <p id="detailsurl">宗旨、价值观及原则康的宗旨是在现在和未来的世世代代确保每个人有更高的生活质量。宗旨是引领，为我们公司的抉择及行动带来了灵感与指导。<br/>
              羿健康在全球范围内举足轻重。我们的市场资本额超过许多国家的国内生产总值，我们的消费者遍布180多个国家和地区。庞大规模带来的是责任和机遇。我们的责任是做一个符合社会道德要求的企业公民，在现在和未来的世世代代确保每个人有更高的生活质量。我们的机遇则更高瞻远瞩，并与我们的“目标”息息相关。</p>
          </div>
        </div>-->
        <div class="introduce notice">
			<div class="title-cxl" style="width: 20%;float: left;padding-top: 24px;font-size:1.4em;color: #f17142;">下单须知:</div>
			<div class="content notice_write">
				<p id="resinform" style="width: 70%;float: left;color: #f17142;">请在玉佛发牢骚似懂非懂浪费哦是减肥神经反射。</p>
				
			</div>
			
		</div>
        <div class="qqq">
          <div class="inset">
            <p ><!--<i name="gcourseprice">凭会员卡免费预约</i>--></p>
            <a href="javascript:void(0);" rel="external" data-role="none" >确认预约</a> </div>
        </div>
      </li>
    </ul>
  </div>
</div>
<script type="text/javascript">  /*http://127.0.0.1:8020/assets/gcourse.html?gcalid=G000038&conphone=13400001111&memid=M000443 俱乐部团操*/
/*
 图片加载失败处理
 乔丽娜 2016/9/20
 * */
function nofind(){
	var img=event.srcElement; 
	img.src="images/page/zhanwei.png"; 
	img.onerror=null; //控制不要一直跳动 
} 
var memid = getMemid();
var gcalid = parmData.gcalid;
$(document).ready(function() {
		initData();
		/*
		 * 时间列表显示消失切换
		 * */
		$("#tog").click(function(){
			if($("#arrou").attr("src")=="images/jiantou_botton_default.png")
			   {
				$("#arrou").attr("src","images/jiantou_botton_down.png");
				$("#arrou").addClass("arrox");
			   }
			   else
			   {
				$("#arrou").attr("src","images/jiantou_botton_default.png");
				$("#arrou").removeClass("arrox");
			   }
			   $("#togg").toggle();
		})
		
		
});
function initData(){
	$.ajax({
        type: "POST", //请求方式
        url: serviceUrl+"mclubGlessonList.do", //请求路径
        cache: false,
        data: {
        	gcalid: gcalid,
        	memid: memid
        },
        dataType: 'JSON',   //返回值类型
        beforeSend:function(){
			!window.mobile||window.mobile.Loading(true);
		},
        success: function (data) {
            var msgFlag = data.msgFlag;
            if (msgFlag == 1) {
            	var gcalattr=data.gcallisth.gcalattr;
            	var hasOrder=data.hasOrder;
            	var gcourseprice=data.gcallisth.gcourseprice;
            	if(gcourseprice == "0"){
            		$("#gcourseprice").text("凭会员卡免费预约");
            		
            	}else{
            		$("#gcourseprice").text(gcourseprice+"元")
            	}
            	if(gcalattr == "club"){
            		if(hasOrder == 0){
            			/*alertInfo("您还没有会籍订单");*/
            			$(".inset a").attr("href","javascript:alertInfo('您还没有会籍订单,请去线下门店购买');");
            		}else{
            			$(".inset a").attr("href","javascript:lessonsave();");//生成预约
            		}
            	}else{//coach
            		if(hasOrder == 0){
            			$(".inset a").text("购买课程");
            			$(".inset a").attr("href","javascript:gotoExe();");//
            		}else{
            			$(".inset a").attr("href","javascript:lessonsave();")//生成预约
            		}
            	}
            	
                var glessonList = data.glessonList;
                $("#address").text(data.gcallisth.address);//俱乐部地址
                $("#clubname").text(data.gcallisth.clubname);//俱乐部名称
      			if(glessonList.length != 0){
      				$("#imgpfile").attr("src", glessonList[0].imgpfilename);//课程图片
      				$("#gcoursename").text(glessonList[0].gcalname);//课程名称
      				$("#conphone").text(glessonList[0].conphone);//俱乐部电话
      			}
      			else{
      				alertInfo("没有课节");
      			}
      			var mobphone = $("#conphone");
                mobphone.parent("a").bind("click", function(){//绑定点击事件为调用原生拨打电话方法
                	callUp(this, mobphone.text());
                });
                /*document.title = bGlesson.gcalname;*/
                /*
				//根据业务需求免费
//     		    $("i[name=gcourseprice]").text(bGcourse.gcourseprice);
                $("#coachname").text(bGlesson.coachname);//教练名称
                $("#resinform").text(bClub.resinform);//须知
                $(".star_shi").css("width",parseFloat(bClub.evascore*20) + "px");//星数
                console.info(bGlesson.begintime);
                $("#begintime").text(formatdate(bGlesson.begintime,"yyyy-MM-dd hh:mm"));
                
                */
                //循环开始
                
		        $.each(data.glessonList,function(index,content){//初始化时间信息
		        	var li = $("<li><a href='javascript:void(0);'><span id="+content.lessonid + ">" + content.begintimestr + "<span></a></li>");
		        	$("#togg ul").append(li);
		        	var coursetitle=$(".choosen span").text();
		        	$("#begintime").text(coursetitle);
		        	$("#togg ul li").eq(0).addClass("choosen");//选中第一个
		        
		        	/*lessonid=$(".choosen span").attr("id");*/
		        	/*
		        	 * 点击选中
		        	 * */
		        	li.bind("click", function() {
		        		$("#togg li").removeClass("choosen");
		        		$(this).addClass("choosen");
		        		var coursetitle=$(".choosen span").text();
		        		$("#begintime").text(coursetitle);
		        	})
		        	
		        })
            }
           
        },
		complete:function(){
			!window.mobile||window.mobile.Loading(false);
		}
    });		
}
function lessonsave(){
	var lessonid=$(".choosen span").attr("id");
	console.log(lessonid);
  	$.ajax({
  		type: "POST", //请求方式
        url: serviceUrl+"mbcorderlessonsave.do", //请求路径
        cache: false,
        data: {
        	memid: memid,
        	lessonid:lessonid
        },
        dataType: 'JSON',   //返回值类型
        success:function(data){
        	if (data.msgFlag == 1) {
				alertMessage("success","生成预约成功");
				!window.mobile||window.mobile.gotoBespeakList();
			}else{
				alertInfo(data.msgContent);
			}
		}
    })
}
function gotoExe(){
    var page = "courseBuy.html?mertype=gcourse&courseid="+gcalid+"&memid="+getMemid();
    createNewWindow(page);
}
</script>
</body>
</html>
