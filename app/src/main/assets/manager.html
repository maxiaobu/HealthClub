<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta http-equiv="Access-Control-Allow-Origin" content="*">
		<title id="titleBar" isback="1" btn="0" navbar="0">档期管理</title>
		<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" type="text/css" />
		<link rel="stylesheet" href="css/style.css" type="text/css" />
		
		<script type="text/javascript" src="js/jquery.min.js"></script>
		<script>
		/*rem布局设置 
		 * 乔丽娜
		 **/
			(function (root) {
			  var docEl = document.documentElement,
			    timer = null;
			  function changeRem () {
			    root.rem = docEl.getBoundingClientRect().width / 10;
			    docEl.style.fontSize = root.rem + 'px';
			  }
			
			  root.addEventListener('resize', function () {
			    clearTimeout(timer);
			    timer = setTimeout(changeRem, 300);
			    location.reload();
			    height();
			  });
			  root.addEventListener('pageshow', function (e) {
			    if (e.persisted) {
			      clearTimeout(timer);
			      timer = setTimeout(changeRem, 300);
			      height();
			      
			    }
			  });
			  changeRem();
			})(window, undefined);
			$(document).bind('mobileinit', function() {
				$.mobile.pushStateEnabled = false;
			});
		</script>
		<script type="text/javascript" src="js/jquery.mobile-1.4.5.min.js"></script>
		<script type="text/javascript" src="js/mframe.js"></script>
		<!--http://127.0.0.1:8020/assets/manager.html?coachid=M000440-->
	</head>

	<body>
		<div data-role="page" style="background:none;">
			<div data-role="content" class="reservation">
				
				<div class="res_down res_manager">
					<div class="re_nav" style="padding-top: 15px;">
						<ul id="tabs">
							<li id="tag7">
								<a href="#" name="#tab7">
									<p class="p1">周日</p>
									<p class="p2"></p>
								</a>
							</li>
							<li id="tag1">
								<a href="#" name="#tab1">
									<p class="p1">周一</p>
									<p class="p2"></p>
								</a>
							</li>
							<li id="tag2">
								<a href="#" name="#tab2">
									<p class="p1">周二</p>
									<p class="p2"></p>
								</a>
							</li>
							<li id="tag3">
								<a href="#" name="#tab3">
									<p class="p1">周三</p>
									<p class="p2"></p>
								</a>
							</li>
							<li id="tag4">
								<a href="#" name="#tab4">
									<p class="p1">周四</p>
									<p class="p2"></p>
								</a>
							</li>
							<li id="tag5">
								<a href="#" name="#tab5">
									<p class="p1">周五</p>
									<p class="p2"></p>
								</a>
							</li>
							<li id="tag6">
								<a href="#" name="#tab6">
									<p class="p1">周六</p>
									<p class="p2"></p>
								</a>
							</li>
						</ul>
					</div>
					<div class="whole">
						<div class="w_inset"><span>全选</span><img id="selectAll" src="images/page/iconfont.png" width="20" height="20" /></div>
					</div>
					<div class="bor"></div>
					<div id="content" style="background: #fff;">
						<div id="tab7">
							
							<ul class="show_ul" style="" name="sunday">
								<li name="10"><p><em>10:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
									<li name="11"><p><em>11:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
										<li name="12"><p><em>12:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
											<li name="13"><p><em>13:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20" ></p>
												<li name="14"><p><em>14:00</em><img class='tru-cxl' src='images/page/iconfont.png'  width="20" height="20"></p>
													<li name="15"><p><em>15:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
														<li name="16"><p><em>16:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
															<li name="17"><p><em>17:00</em><img class='tru-cxl' src='images/page/iconfont.png'  width="20" height="20"></p>
																<li name="18"><p><em>18:00</em><img class='tru-cxl' src='images/page/iconfont.png'  width="20" height="20"></p>
																	<li name="19"><p><em>19:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																		<li name="20"><p><em>20:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
	
							
							</ul>
						</div>
						<div id="tab1">
							<ul class="show_ul" style="" name="sunday">
								<li name="10"><p><em>10:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
									<li name="11"><p><em>11:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
										<li name="12"><p><em>12:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
											<li name="13"><p><em>13:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
												<li name="14"><p><em>14:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
													<li name="15"><p><em>15:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
														<li name="16"><p><em>16:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
															<li name="17"><p><em>17:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																<li name="18"><p><em>18:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																	<li name="19"><p><em>19:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																		<li name="20"><p><em>20:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
							</ul>
						</div>
						<div id="tab2">
							<ul class="show_ul" style="" name="sunday">
								<li name="10"><p><em>10:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
									<li name="11"><p><em>11:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
										<li name="12"><p><em>12:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
											<li name="13"><p><em>13:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
												<li name="14"><p><em>14:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
													<li name="15"><p><em>15:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
														<li name="16"><p><em>16:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
															<li name="17"><p><em>17:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																<li name="18"><p><em>18:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																	<li name="19"><p><em>19:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																		<li name="20"><p><em>20:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
							</ul>
						</div>
						<div id="tab3">
							<ul class="show_ul" style="" name="sunday">
								<li name="10"><p><em>10:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
									<li name="11"><p><em>11:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
										<li name="12"><p><em>12:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
											<li name="13"><p><em>13:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
												<li name="14"><p><em>14:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
													<li name="15"><p><em>15:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
														<li name="16"><p><em>16:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
															<li name="17"><p><em>17:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																<li name="18"><p><em>18:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																	<li name="19"><p><em>19:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																		<li name="20"><p><em>20:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
							</ul>
						</div>
						<div id="tab4">
							<ul class="show_ul" style="" name="sunday">
								<li name="10"><p><em>10:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
									<li name="11"><p><em>11:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
										<li name="12"><p><em>12:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
											<li name="13"><p><em>13:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
												<li name="14"><p><em>14:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
													<li name="15"><p><em>15:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
														<li name="16"><p><em>16:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
															<li name="17"><p><em>17:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																<li name="18"><p><em>18:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																	<li name="19"><p><em>19:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																		<li name="20"><p><em>20:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
							</ul>
						</div>
						<div id="tab5">
							<ul class="show_ul" style="" name="sunday">
								<li name="10"><p><em>10:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
									<li name="11"><p><em>11:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
										<li name="12"><p><em>12:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
											<li name="13"><p><em>13:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
												<li name="14"><p><em>14:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
													<li name="15"><p><em>15:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
														<li name="16"><p><em>16:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
															<li name="17"><p><em>17:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																<li name="18"><p><em>18:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																	<li name="19"><p><em>19:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																		<li name="20"><p><em>20:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
							</ul>
						</div>
						<div id="tab6">
							<ul class="show_ul" style="" name="sunday">
								<li name="10"><p><em>10:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
									<li name="11"><p><em>11:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
										<li name="12"><p><em>12:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
											<li name="13"><p><em>13:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
												<li name="14"><p><em>14:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
													<li name="15"><p><em>15:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
														<li name="16"><p><em>16:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
															<li name="17"><p><em>17:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																<li name="18"><p><em>18:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																	<li name="19"><p><em>19:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
																		<li name="20"><p><em>20:00</em><img class='tru-cxl' src='images/page/iconfont.png' width="20" height="20"></p>
							</ul>
						</div>
					</div>
				</div>
				<div class="e_pos">
					<a href="javascript:void(0);" rel="external" data-role="none" class="jiuanary-thirty" onclick="manangersave();">保存</a>
				</div>
			</div>
			<!--mui替换弹出窗口-->
			<!--<div id="side" r_time="" class="side">
				<div class="s_content">
					<p>确认预约11月25日周五13:00？</p>
					<div class="btnList">
						<a href="javascript:submit()" rel="external" data-role="none">确认</a><a id="close" href="" rel="external" data-role="none">取消</a>
					</div>
				</div>
			</div>-->
			<script type="text/javascript"> <!--http://127.0.0.1:8020/assets/manager.html?coachid=M000440-->
			
				window.onload = function() {
					//对头部日期进行初始化
					initDate();
					initData();
					height();
				};
				var url = window.location.href;
				parmData = getUrlParam(url);
				function getUrlParam(string) {
					var obj = {};
					if (string.indexOf("?") != -1) {
						var string = string.substr(string.indexOf("?") + 1);
						var strs = string.split("&");
						for (var i = 0; i < strs.length; i++) {
							var tempArr = strs[i].split("=");
							obj[tempArr[0]] = decodeURI(tempArr[1]);
						}
					}
					return obj;
				}
				function resetTabs() {
					$("#content > div").hide(); //隐藏所有内容
					$("#tabs a").attr("class", ""); //重置“id”
					$("#selectAll").attr("src", "images/page/iconfont.png");
				}
				var myUrl = window.location.href; //取得超链地址
				var myUrlTab = myUrl.substring(myUrl.indexOf("#"));
				console.log(myUrl);
				var myUrlTabName = myUrlTab.substring(0, 4);
				console.log(myUrlTabName)
				/**
				 * 初始化日期栏
				 */
				function initDate() {
					var date = new Date();
					for (var i = 0; i < 7; i++) {
						var dayOfWeek = date.getDay() + i;
						if (dayOfWeek > 7) { //如果循环过周日则回到周一
							dayOfWeek -= 7;
						}
						var curDate = date.getDate() + i;
						//当前月最大天数
						var curMonthDays = new Date(date.getFullYear(), (date.getMonth() + 1), 0).getDate();
						if (curDate > curMonthDays) {
							curDate -= curMonthDays;
						}
						if (dayOfWeek==0) {
							$("#tag" + 7 + " p.p2").text(curDate);
						}else{
							$("#tag" + dayOfWeek + " p.p2").text(curDate);
						}
						
						if (i == 0) {
							if (dayOfWeek==0) {
								$("#tag" + 7 + " a").attr("id", "current").attr("class", "current");
							}else{
								$("#tag" + dayOfWeek + " a").attr("id", "current").attr("class", "current");
							}
							
						}
					}
				}
				/**
				 * 初始化数据
				 */
				function initData() {
				$.ajax({
					type: "POST", //请求方式
					url: serviceUrl + "mmanager.do", //请求路径
					cache: false,
					data: {
						coachid: parmData.coachid //当前用户id
					},
					dataType: 'JSON', //返回值类型
					success: function(data) {
						$($("#tabs .current").attr('name')).fadeIn();//显示当天选项卡
						$("#selectAll").bind("click", selectAll);
						$("ul li img").bind("click", clickItem);
						var test = 0;
						var msgFlag = data.msgFlag;
						
						if (msgFlag == 1) {
							//循环加载列表数据
							var managerlist = data.managerlist;
							$.each(managerlist, function(index, content) {
								var times = content.schtimeslice.split("|");
								$.each(times, function(i, time) {
									if (time != "") {
										var li = $("#tab" + content.weekday + " li[name='" + time + "']");
										li.find("img").attr("src", "images/button_down.png");
									}
								});
							});
						}
					}
				});
			}
				(function() {
					$("#content > div").hide(); // 最初隐藏所有内容
					
					$("#tabs a").on("click", function(e) {
						e.preventDefault();
						if ($(this).attr("class") == "current") { //检测当前选项卡
							return
						} else {
							resetTabs();
							$(this).attr("class", "current"); // 激活这
							$($(this).attr('name')).fadeIn(); // 显示当前选项卡的内容
						}
					});
					for (i = 1; i <= $("#tabs li").length; i++) {
						if (myUrlTab == myUrlTabName + i) {
							resetTabs();
							$("a[name='" + myUrlTab + "']").attr("class", "current"); // 激活url选项卡
							$(myUrlTab).fadeIn(); // 显示url选项卡内容
						}
					}
				})();
				
				/*$("#close").click(function() {
					$("#side").attr("style", "display:none");
				});*/
				//保存档期
			function manangersave() {
				var schtimeslice = "{";
				for (var i = 1; i < 8; i++) {
					var times = $("#tab" + i + " img[src='images/button_down.png']");
					var timestr = "";
					$.each(times, function(index, time) {
						/*timestr += time.parentNode.getAttribute('name') + "|";*/
						timestr += $(time).parents("li").attr('name')+"|"
					});
					if (i != 7) {
						schtimeslice += '"' + i + '" : "' + timestr + '" ,';
					} else {
						schtimeslice += '"' + i + '" : "' + timestr + '" }';
					}
					console.log(schtimeslice);

				}
				$.ajax({
					type: "POST",
					url: serviceUrl + "mmanangersave.do",
					data: {
						coachid: parmData.coachid,
						schtimeslice: schtimeslice
					},
					dataType: "JSON",
					success: function(data) {
						if (data.msgFlag == 1) {
							alertMessage("success","档期保存成功");
		            	  	backExe();
						}
					}
				});
			}
				//给content定高  乔丽娜
				function height(){
					var c=myScroll.windowHeight();
					$(".reservation").css("height",c);
					var rheight=parseFloat($("#tag1").css("height"));
					var con=c-rheight-150;
					$("#content").css("height",con+"px");
				}
					
				//全选/全不选
			function selectAll() {
				var selectAll = $(this);
				var img = $($(".current").attr("name") + " li img");
				if (selectAll.attr("src") == "images/page/iconfont.png") {
					img.attr("src", "images/button_down.png");
					$(this).attr("src", "images/button_down.png");
				} else {
					img.attr("src", "images/page/iconfont.png");
					$(this).attr("src", "images/page/iconfont.png");
				}
			}
			
			//点击档期事件
			function clickItem() {
				var img = $(this);
				if (img.attr("src") == "images/button_down.png") {
					img.attr("src", "images/page/iconfont.png");
				} else {
					img.attr("src", "images/button_down.png");
				}
			}
				
			</script>
	</body>

</html>